<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting Started &mdash; cls-luigi 0.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/js/fullscreen.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Examples" href="../../examples.html" />
    <link rel="prev" title="Installation" href="../../installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            cls-luigi
          </a>
              <div class="version">
                0.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started-with-pure-luigi">Getting Started with pure Luigi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction-to-basic-concepts">Introduction to Basic Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-a-luigi-task">What is a Luigi Task?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advantage-of-luigi">Advantage of Luigi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#from-luigi-to-cls-luigi">From Luigi to CLS-Luigi</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-concepts-of-cls-luigi">Basic concepts of CLS-Luigi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-run-your-very-first-cls-luigi-pipeline">How to run your very first CLS-Luigi Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ml-pipeline-example">ML-Pipeline example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-dictionaries-instead-of-lists-in-requires-and-output-methods">Using dictionaries instead of lists in <em>requires</em> and <em>output</em> methods</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#known-issues">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">cls-luigi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Getting Started</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/cls-python/cls-luigi/blob/main/docs/examples/getting_started/README.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading"></a></h1>
<p>The purpose of this guide is to illustrate some of the main features that CLS-Luigi provides. It assumes a very basic knowledge of python. Please refer to our <a class="reference internal" href="../../installation.html"><span class="doc">installation instructions</span></a> for installing CLS-Luigi.</p>
<section id="getting-started-with-pure-luigi">
<span id="luigi-getting-started"></span><h2>Getting Started with pure Luigi<a class="headerlink" href="#getting-started-with-pure-luigi" title="Permalink to this heading"></a></h2>
<p>As CLS-Luigi leverages the capabilities provided by <a class="reference external" href="https://luigi.readthedocs.io/en/stable/index.html">Luigi</a> , it becomes essential to provide a brief introduction to Luigi itself, ensuring a solid foundation for understanding CLS-Luigi’s functionalities.</p>
<section id="introduction-to-basic-concepts">
<h3>Introduction to Basic Concepts<a class="headerlink" href="#introduction-to-basic-concepts" title="Permalink to this heading"></a></h3>
<p>Luigi is a powerful open-source framework developed by Spotify for building data pipelines. It allows you to define and execute complex workflows with multiple tasks and dependencies. Luigi provides a clean and simple interface for managing dependencies and orchestrating the execution of tasks in a distributed environment.
Luigi models pipelines as Directed Acyclic Graphs (DAGs), where tasks are represented as nodes, and dependencies between tasks are represented as edges. This graph structure allows you to define complex workflows with interdependent tasks. Luigi ensures that tasks are executed in the correct order based on their dependencies, minimizing redundant computations.</p>
</section>
<section id="what-is-a-luigi-task">
<h3>What is a Luigi Task?<a class="headerlink" href="#what-is-a-luigi-task" title="Permalink to this heading"></a></h3>
<p>In Luigi, a task represents an atomic unit of work in a pipeline. Tasks are defined as Python classes that inherit from <code class="docutils literal notranslate"><span class="pre">luigi.Task</span></code>. Each task should have an <code class="docutils literal notranslate"><span class="pre">output()</span></code> method that specifies the output it produces. The <code class="docutils literal notranslate"><span class="pre">run()</span></code> method contains the logic for executing the task. Luigi provides various other methods, such as <code class="docutils literal notranslate"><span class="pre">requires()</span></code>, <code class="docutils literal notranslate"><span class="pre">complete()</span></code>, and <code class="docutils literal notranslate"><span class="pre">output()</span></code>, to define dependencies, check task completeness, and specify output targets.</p>
</section>
<section id="advantage-of-luigi">
<h3>Advantage of Luigi<a class="headerlink" href="#advantage-of-luigi" title="Permalink to this heading"></a></h3>
<p>One of the key advantages of Luigi is its built-in caching mechanism. Luigi automatically tracks the completeness of tasks and their dependencies. If a task has already been completed and its dependencies have not changed, Luigi uses the cached result, avoiding unnecessary re-computation. This caching mechanism significantly improves the efficiency of pipeline execution, especially in scenarios where tasks have expensive computations or external dependencies.</p>
</section>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading"></a></h3>
<p>To illustrate the concepts, here’s a simple example using Luigi. You can find the example <a class="reference external" href="https://github.com/cls-python/cls-luigi/tree/main/examples/getting_started/10_getting_started_luigi.py">here</a>:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Example: 10_getting_started_luigi.py</span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">luigi</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">class</span> <span class="nc">TaskA</span><span class="p">(</span><span class="n">luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
<span class="linenos"> 4</span>    <span class="k">def</span> <span class="nf">requires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 5</span>        <span class="k">return</span> <span class="kc">None</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 8</span>        <span class="k">return</span> <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;output/taskA_output.txt&quot;</span><span class="p">)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">11</span>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">12</span>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Task A completed&quot;</span><span class="p">)</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="k">class</span> <span class="nc">TaskB</span><span class="p">(</span><span class="n">luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
<span class="linenos">15</span>    <span class="k">def</span> <span class="nf">requires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">16</span>        <span class="k">return</span> <span class="n">TaskA</span><span class="p">()</span>
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">19</span>        <span class="k">return</span> <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;output/taskB_output.txt&quot;</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">22</span>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
<span class="linenos">23</span>            <span class="n">data</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos">24</span>            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Task B completed with input: &quot;</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">27</span>    <span class="n">luigi</span><span class="o">.</span><span class="n">build</span><span class="p">([</span><span class="n">TaskB</span><span class="p">()],</span> <span class="n">local_scheduler</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In this example, we have two tasks: <code class="docutils literal notranslate"><span class="pre">TaskA</span></code> and <code class="docutils literal notranslate"><span class="pre">TaskB</span></code>. <code class="docutils literal notranslate"><span class="pre">TaskB</span></code> requires <code class="docutils literal notranslate"><span class="pre">TaskA</span></code> as its dependency. <code class="docutils literal notranslate"><span class="pre">TaskA</span></code> writes a simple message to its output file, and <code class="docutils literal notranslate"><span class="pre">TaskB</span></code> reads the output of <code class="docutils literal notranslate"><span class="pre">TaskA</span></code> and appends a message before writing it to its own output file.</p>
<p>To run the example, execute the Python script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>10_getting_started_luigi.py
</pre></div>
</div>
<p>The execution of <code class="docutils literal notranslate"><span class="pre">TaskB</span></code> will automatically trigger the execution of <code class="docutils literal notranslate"><span class="pre">TaskA</span></code> due to the defined dependency. The output files for each task will be created in the specified <code class="docutils literal notranslate"><span class="pre">output/</span></code> directory.</p>
<p>This introductory information should be sufficient to understand CLS-Luigi. There are of course many more possibilities that Luigi offers, e.g. different wrapper tasks to interact with different data and databases. More information can be found in the <a class="reference external" href="https://luigi.readthedocs.io/en/stable/">documentation of Luigi</a>.</p>
</section>
</section>
<section id="from-luigi-to-cls-luigi">
<h2>From Luigi to CLS-Luigi<a class="headerlink" href="#from-luigi-to-cls-luigi" title="Permalink to this heading"></a></h2>
<p>CLS-Luigi combines Luigi with the <a class="reference external" href="https://eldorado.tu-dortmund.de/handle/2003/38387">(CL)S Framework</a>. CLS is a Type-Theoretic Framework for Software Component Synthesis.</p>
<p>CLS fundamentally solves the type-theoretical
problem of inhabitation. This problem denotes the question if a well-typed applicative term exists, that can be formed from a given repository Γ of typed combinators to satisfy a user-specified target type. The inhabitation problem can be expressed mathematically as follows: Γ ⊢? : σ. The repository Γ consists of combinators in the form (c : τ ) which can be read as ”In the respository Γ it is assumed that combinator c has type τ ”. CLS implements a inhabitation algorithm that uses the combinator types to determine which combinators can be applied to each other in order to satisfy the user-specified type σ. If a Term M exists, such as it satisfies the inhabitation request (Γ ⊢ M : σ), then we call M inhabitant of σ. If you want to learn more about the topic, you can read <a class="reference external" href="https://eldorado.tu-dortmund.de/handle/2003/38387">this</a>.</p>
<p>In our use case CLS generates and executes Luigi pipelines. The Repository is composed of Classes that are derived from <code class="docutils literal notranslate"><span class="pre">luigi.Task</span></code> and <code class="docutils literal notranslate"><span class="pre">cls_luigi.inhabitation_task.LuigiCombinator</span></code>. Finding the correct abstraction level, modeling components and creating the repository are sometimes the most difficult tasks when using CLS. It requires a lot of modeling experience as well as domain knowledge about the problem. To solve this challenge, CLS-Luigi uses Pythons reflection mechanisms to create the repository automatically. The user does not have to worry about this and simply implements components that he would have to implement anyways in some way.</p>
<p>CLS-Luigi generates all feasible luigi pipelines for a given target based on a repository of luigi-tasks using cls-python.</p>
<p>A Luigi tasks that not only inherit from <code class="docutils literal notranslate"><span class="pre">luigi.Task</span></code> but also from <code class="docutils literal notranslate"><span class="pre">inhabitation_task.LuigiCombinator</span></code> are automatically considered a component and thus will be added to the repository. All that needs to be done is to implement the methods <code class="docutils literal notranslate"><span class="pre">run()</span></code>, <code class="docutils literal notranslate"><span class="pre">output()</span></code> and <code class="docutils literal notranslate"><span class="pre">requires()</span></code>.</p>
</section>
<section id="basic-concepts-of-cls-luigi">
<h2>Basic concepts of CLS-Luigi<a class="headerlink" href="#basic-concepts-of-cls-luigi" title="Permalink to this heading"></a></h2>
<p>In the following section, we will give a short introduction on how to use CLS-Luigi. The examples found throughout can be found in the repository in the <a class="reference external" href="https://github.com/cls-python/cls-luigi/tree/main/examples/getting_started/">examples/getting_started</a> folder.</p>
<p>We will structure it as follows:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#how-to-run-your-very-first-cls-luigi-pipeline">How to run your very first CLS-Luigi Pipeline</a></p></li>
<li><p><a class="reference external" href="#dfo">Define dependencies on other tasks</a></p></li>
<li><p><a class="reference external" href="#avp">Add variation points</a></p></li>
<li><p><a class="reference external" href="#vpa">Variation points as a dependency</a></p></li>
</ul>
<section id="how-to-run-your-very-first-cls-luigi-pipeline">
<h3>How to run your very first CLS-Luigi Pipeline<a class="headerlink" href="#how-to-run-your-very-first-cls-luigi-pipeline" title="Permalink to this heading"></a></h3>
</section>
<section id="ml-pipeline-example">
<h3>ML-Pipeline example<a class="headerlink" href="#ml-pipeline-example" title="Permalink to this heading"></a></h3>
<p>You can find the source for the example <a class="reference external" href="https://github.com/cls-python/cls-luigi/tree/main/examples/getting_started/70_ml_example.py">here</a>:</p>
<p>Let’s consider an example where we predict the blood sugar level of some
patients. In this example we first start by loading the dataset from
Scikit-Learn, then we split it into 2 subsets for training and testing.</p>
<p>The first variation point is the scaling method. We introduce 2 concrete
implementation, namely <code class="docutils literal notranslate"><span class="pre">RobustScaler</span></code>&amp; <code class="docutils literal notranslate"><span class="pre">MinMaxScaler</span></code>. After
scaling we have our second variation point which is the regression
model. Here we have also 2 concrete implementation, namely
<code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">LassoLars</span></code>.</p>
<p>Lastly we evaluate each regression model by predicting the testing
target and calculating the root mean squared error.</p>
<p>In this specific case we should have the following 4 pipelines:</p>
<p>We can see that <code class="docutils literal notranslate"><span class="pre">RobustScaler</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">MinMaxScaler</span></code> is required by both
the <code class="docutils literal notranslate"><span class="pre">TrainLinearRegressionModel</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">TrainLassoLarsModel</span></code>, and
<code class="docutils literal notranslate"><span class="pre">EvaluateRegressionModel</span></code></p>
<p>So the pipeline validation in this case looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">validator</span> <span class="o">=</span> <span class="n">UniqueTaskPipelineValidator</span><span class="p">([</span><span class="n">FitTransformScaler</span><span class="p">])</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">inhabitation_result</span><span class="o">.</span><span class="n">evaluated</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">max_results</span><span class="p">]</span> <span class="k">if</span> <span class="n">validator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">t</span><span class="p">())]</span>
</pre></div>
</div>
<section id="using-dictionaries-instead-of-lists-in-requires-and-output-methods">
<h4>Using dictionaries instead of lists in <em>requires</em> and <em>output</em> methods<a class="headerlink" href="#using-dictionaries-instead-of-lists-in-requires-and-output-methods" title="Permalink to this heading"></a></h4>
<p>Code for this example is to be found
<a class="reference external" href="hello_world_examples/_71_ML_example_with_dicts.py">here</a></p>
<p>Till now, we only showed how to handle multiple dependencies and outputs
using lists. However, lists can be akward to handle, especially once you
deal with nested lists. Indexes are just not very easily readable.</p>
<p>In the <a class="reference external" href="hello_world_examples/_70_ML_example_variation_point_multi_usage.py">last
example</a>
we returned the output of data splitting in a list as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;x_train.pkl&quot;</span><span class="p">),</span>
        <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;x_test.pkl&quot;</span><span class="p">),</span>
        <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;y_train.pkl&quot;</span><span class="p">),</span>
        <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;y_test.pkl&quot;</span><span class="p">)</span>
    <span class="p">]</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="o">...</span>
   <span class="o">...</span>
   <span class="o">...</span>
    <span class="n">X_train</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">X_test</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">y_train</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">y_test</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>Note how we defined our outputs in <em>output</em> method, and had to feed in
the index number of corresponding LocalTarget in the <em>run</em> method. We
can do better than that! #### solution We can use dictionaries instead
of lists, and reference the corresponding LocalTargets using keys:</p>
<p>if your haven’t looked at the code for this example, you can also find
it <a class="reference external" href="hello_world_examples/_71_ML_example_with_dicts.py">here</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TrainTestSplit</span><span class="p">(</span><span class="n">luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">,</span> <span class="n">LuigiCombinator</span><span class="p">):</span>
    <span class="n">abstract</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">diabetes</span> <span class="o">=</span> <span class="n">inhabitation_task</span><span class="o">.</span><span class="n">ClsParameter</span><span class="p">(</span><span class="n">tpe</span><span class="o">=</span><span class="n">LoadDiabetesData</span><span class="o">.</span><span class="n">return_type</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;x_train&quot;</span><span class="p">:</span> <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;x_train.pkl&quot;</span><span class="p">),</span>
            <span class="s2">&quot;x_test&quot;</span><span class="p">:</span> <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;x_test.pkl&quot;</span><span class="p">),</span>
            <span class="s2">&quot;y_train&quot;</span><span class="p">:</span> <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;y_train.pkl&quot;</span><span class="p">),</span>
            <span class="s2">&quot;y_test&quot;</span><span class="p">:</span> <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;y_test.pkl&quot;</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="o">...</span>
       <span class="o">...</span>
       <span class="o">...</span>

        <span class="n">X_train</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()[</span><span class="s2">&quot;x_train&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">X_test</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()[</span><span class="s2">&quot;x_test&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">y_train</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()[</span><span class="s2">&quot;y_train&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">y_test</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()[</span><span class="s2">&quot;y_test&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>This is way easier to read! By using dictionaries we don’t need to
memorize the indexes of elements or even car about their order. We can
just use the keys without having to go back searching for the write
index.</p>
<p>Note: You can use this way in your <em>requires</em> method as well. and
instead of referencing as follows: ```python def requires(self): return
[self.my_dependency()]</p>
<p>def run(self): … # use the dependency output self.input()[0]</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>your can just do the following instead:
```python
def requires(self):
   return {&quot;some_dependency&quot;: self.my_dependency()}

def run(self):
   ...
   # use the dependency output
    self.input()[&quot;some_dependency&quot;]
</pre></div>
</div>
<p>This obviously makes more sense with multiple dependencies.</p>
<p>Lastly: if you return dictionaries in both your <em>output</em> method and your
’requires* method , don’t forget that you have to reference 2 keys now.
Still better as indexes :)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomeTaskA</span><span class="p">(</span><span class="n">luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">,</span> <span class="n">inhabitation_task</span><span class="o">.</span><span class="n">LuigiCombinator</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">Luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;output.suffix&quot;</span><span class="p">)}</span>


<span class="k">class</span> <span class="nc">SomeTaskA</span><span class="p">(</span><span class="n">luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">,</span> <span class="n">inhabitation_task</span><span class="o">.</span><span class="n">LuigiCombinator</span><span class="p">):</span>
   <span class="n">dependency</span> <span class="o">=</span> <span class="n">ClsParameter</span><span class="p">(</span><span class="n">tpe</span><span class="o">=</span> <span class="n">SomeTaskA</span><span class="o">.</span><span class="n">return_type</span><span class="p">())</span>

   <span class="k">def</span> <span class="nf">requires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;output_from_SomeTaskA&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependency</span><span class="p">()}</span>

   <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="o">...</span>
    <span class="c1"># do something with your input (dependency)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">()[</span><span class="s2">&quot;output_from_SomeTaskA&quot;</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Luigi on Windows got some <a class="reference external" href="https://luigi.readthedocs.io/en/stable/running_luigi.html?highlight=windows#luigi-on-windows">problems</a> due to the fact how windows is handling (or better not handling) forking of the python interpreter.</p></li>
<li><p>CLS-Python has the same problem since it is also using the multiprocessing package. This has an impact on the performance on windows, which makes the inhabitation process a bit longer than on linux.</p></li>
<li><p>The visualizer currently still has problems visualizing inheritance hierarchies and can currently only display pipelines that only contain Tasks that are direct implementations of luigi.Tasks and LuigiCombinator (see getting_started and lot_sizing examples). Therefore, we have currently refrained from using the classes in the module cls_tasks as base classes, as this would make the use of the visualizer impossible. On the other hand, only tasks are visualized, which are derived from LuigiCombinator and thus by using reflection are added to the Repository. However, pure Luigi tasks can also be used. While the visualizer’s functionality is not yet fully comprehensive, it still offers valuable visualization capabilities for pipelines comprising tasks derived from luigi.Task and LuigiCombinator. Future enhancements and updates to the visualizer aim to address the challenges associated with visualizing inheritance hierarchies and expand the range of supported task types.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Jan Bessai, Anne Meyer, Hadi Kutabi, Daniel Scholtyssek.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>